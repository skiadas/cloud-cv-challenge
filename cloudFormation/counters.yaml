AWSTemplateFormatVersion: "2010-09-09"
Description: Resources needed to orchestrate the counters
Transform: AWS::Serverless-2016-10-31

Globals:
  Function:
    Runtime: python3.9
Resources:
  IncomingRequestFunction:
    Type: AWS::Serverless::Function
    Name: skiadas-resume-lambda
    Properties:
      Handler: app.lambda_incoming_to_sqs_handler
      CodeUri: ../app/
      Architectures:
        - x86_64

  TotalCountTable:
    Type: AWS::Serverless::SimpleTable
    Properties:
      PrimaryKey:
        Name: path
        Type: String
      TableName: skiadas-resume-SitePathCounts
      Tags:
        project: resume-skiadas

  IncomingRequestQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: skiadas-resume-incoming-request-queue
      MessageRetentionPeriod: 3600 # One hour
      Tags:
        - Key: project
          Value: resume-skiadas

Outputs:
  IncomingRequestFunction:
    Description: Function to trigger on viewer requests
    Value: !Ref IncomingRequestFunction
